<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Issues</title>

  </head>
  <body style="overflow:hidden;padding:0;margin:0;">
    <webview id="webview" src="http://waffle.io" style="position:absolute;width:100%;height:100%;" allowpopups></webview>

    <div id="blur" style="position:absolute;width:100%;height:100%;background-color:black;opacity:0.7;visibility:hidden;"> </div>

    <webview id="popup" src="" style="position:absolute;width:95%;height:95%;top:2%;visibility:hidden;margin-left: auto;margin-right: auto;left: 0;right: 0;" allowpopups></webview>

    <script>
      'use strict'
      const ipcRenderer = require('electron').ipcRenderer;
      let webview = document.getElementById("webview");
      let popup = document.getElementById("popup");
      let blur = document.getElementById("blur");
      let hidePopup = function() {
        blur.style.visibility = 'hidden';
        popup.style.visibility = 'hidden';
        popup.loadURL("");
      };

      let showPopup = function(e) {
        blur.style.visibility = 'visible';
        popup.style.visibility = 'visible';
        popup.loadURL(e.url);
        popup.focus();
      }

      webview.addEventListener('new-window', function(e) {
        showPopup(e);
      });

      popup.addEventListener('blur', function(e) {
        hidePopup();
      });

      popup.addEventListener('keydown', function(e) {
        if(e.keyCode === 27) {
          hidePopup();
        }
      });

      // function notify(num) {
      //   var options = {
      //       body: num,
      //       icon: './images/visible@4x.png'
      //   }
      //
      //   var n = new Notification('Emogotchi says',options);
      // }

      webview.addEventListener('did-get-response-details', function(event) {
        if(event.newURL.indexOf('https://api.waffle.io/projects') !== -1) {
          ipcRenderer.sendSync('synchronous-message', event);
        }
      })

    </script>
  </body>
</html>
